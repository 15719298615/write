2019.10.22
概述运输层和服务：
运输层协议为运行在不同主机上的应用进程之间提供了逻辑通信功能。网络应用程序可以使用多种的运输层协议。
运输层和网络层的关系：
运输层位于网络层之上，网络层提供了主机之间的逻辑通信，而运输层为运行在不同主机上的进
程之间提供了逻辑通信。
多路复用与多路分解：
*就是将由网络层提供的主机到主机交付服务延伸到为运行在主机上的应用程序提供进程到进程的
交付服务。
*在目的主机，运输层从紧邻器下的网络层接受报文段。
*完成方式：一个进程有一个或多个套接字，它相当于从网络向进程传递数据和从进程向网络传递
数据的门户。现在我们考虑接收主机怎样将一个到达的运输层报文段定向到适当的套接字。为此
目的，每个运输层报文段中具有几个字段。在接收端，运输层检查这些字段，识别出接收套接
字，进而将报文段定向到该套接字。将运输层报文段中的数据交付到正确的套接字的工作称为多
路分解。在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息（这将在以后用
于分解）从而生成报文段，然后将报文段传递到网络层，所有这些工作称为多路复用。
*所以通过以上描述我们可以知道运输层多路复用要求：1，套接字由唯一标识。2，每个报文段
有特殊字段来指示该报文段所要交付到的套接字。这些特殊字段是源端口号字段和目的端口号字
段。（0~1023是周知端口号，是被用了的）。
无连接运输：UDP
优势：1，何时，发送什么数据的应用层控制更为精细（TCP有拥塞控制机制，重发）。2，无需
建立连接。3，无连接状态。4，分组首部开销小。（每个TCP报文都有20个字节的首部开销，而
UDP只有8个）
面向连接的运输：TCP
*TCP被称为是面向连接的，这是因为在一个应用进程可以开始向另一个应用进程发送数据之前，
这两个进程必须先相互“握手”，即他们必须相互发送某些预备报文段，以建立确保数据传输的参
数。
*TCP连接提供的是全双工服务。TCP连接也总是点对点的。ACK（确认号）

三次握手：
1，在请求连接时SYN会被置1，当连接已经建立后SYN会被置0.

流量控制：
*TCP为他的应用程序提供了流量控制服务以消除发送方使接收方缓存溢出的可能性。流量控制因
此是一个速度匹配服务，即发送方的发送速率与接收方英勇程序的读取速率相匹配。
拥塞控制：
*并且TCP发送方也可能因为IP网络的拥塞而被遏制，这种形式的发送方的控制被称为拥塞控制
（以上两种是不同的）
*TCP通过让发送方『一个称为接收窗口的变量来提供流量控制。（TCP是全双工通信，在连接
两端的发送方都各自维持一个接收窗口）
tcp状态：
LISTEN：侦听来自远方的TCP端口的连接请求
SYN-SENT：再发送连接请求后等待匹配的连接请求
SYN-RECEIVED：再收到和发送一个连接请求后等待对方对连接请求的确认
ESTABLISHED：代表一个打开的连接
FIN-WAIT-1：等待远程TCP连接中断请求，或先前的连接中断请求的确认
FIN-WAIT-2：从远程TCP等待连接中断请求
CLOSE-WAIT：等待从本地用户发来的连接中断请求
CLOSING：等待远程TCP对连接中断的确认
LAST-ACK：等待原来的发向远程TCP的连接中断请求的确认
TIME-WAIT：等待足够的时间以确保远程TCP接收到连接中断请求的确认
CLOSED：没有任何连接状态
客户端的状态变迁：CLOSED-->SYN_SENT-->ESTABLISHED-->FIN_WAIT_1-->FIN_WAIT_2-->TIME_WAIT-->CLOSED


服务器的状态变迁：CLOSED-->LISTEN-->SYN_RCVD-->ESTABLISHED-->CLOSE_WAIT-->LAST_ACK--->CLOSED

四次挥手图：

拥塞控制方法：
端到端拥塞控制。网络辅助的拥塞控制。
对于网络辅助的拥塞控制，拥塞信息从网络反馈到发送方通常有两种方式。直接反馈信息可以有
网络路由器发给发送方。这种方式的通知通常采用了一种阻塞分组的形式（主要是说：我拥塞
了！）。第二种是：路由器标记或更新从发送方流向接收方的分组中的某个字段来指示拥塞的产
生。
TCP拥塞控制：
TCP必须使用端到端的拥塞控制。因为IP层不向端系统提供显示的网络拥塞反馈。
TCP所采用的方法是让每一个发送方根据所感知到的网络拥塞来限制其能向连接发送流量的速
率。如果一个TCP发送方感知从他到目的地之间的路径上没有拥塞，则TCP发送方增加其发送效
率；如果发送方感知沿着该路径有拥塞，则发送方就会降低其发送速率。

